(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function i(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(o){if(o.ep)return;o.ep=!0;const l=i(o);fetch(o.href,l)}})();function Q(){const n=document.getElementById("game-canvas"),e=document.getElementById("import-input"),i=document.getElementById("duration-input"),r=document.getElementById("duration-label"),o=document.getElementById("time-mode-toggle-btn"),l=document.getElementById("animate-btn"),d=document.getElementById("pause-btn"),a=document.getElementById("insert-keyframe-btn"),h=document.getElementById("mode-btn"),f=document.getElementById("ik-mode-btn"),s=document.getElementById("onion-btn"),t=document.getElementById("full-onion-skin-btn"),g=document.getElementById("motion-trail-step-input"),T=document.getElementById("export-btn"),I=document.getElementById("import-btn"),S=document.getElementById("onion-before-input"),p=document.getElementById("onion-after-input");if(!n||!e||!i||!r||!o||!l||!d||!a||!h||!f||!s||!t||!g||!T||!I||!S||!p)throw new Error("Could not find all required DOM elements.");return{canvas:n,importInput:e,durationInput:i,durationLabel:r,timeModeToggleBtn:o,animateBtn:l,pauseBtn:d,insertKeyframeBtn:a,modeBtn:h,ikModeBtn:f,onionBtn:s,fullOnionSkinBtn:t,motionTrailStepInput:g,exportBtn:T,importBtn:I,onionBeforeInput:S,onionAfterInput:p}}function ee(n,e){return{stickFigurePose:JSON.parse(JSON.stringify(n.defaultPose)),keyframes:[],activeKeyframeIndex:null,activeKeyframeIndexBeforeAnimation:null,groundY:e.GROUND_Y_POSITION,verticalGuideX:50,draggedPointKey:null,isDraggingGround:!1,isDraggingVerticalGuide:!1,draggedMarkerIndex:null,isDraggingPlayhead:!1,draggedThumbnailIndex:null,currentMousePos:null,hoveredThumbnailIndex:null,hoveredDeleteIconIndex:null,hoveredScrollLeft:!1,hoveredScrollRight:!1,hoveredGround:!1,hoveredVerticalGuide:!1,hoveredMarkerIndex:null,hoveredPlayhead:!1,scrollOffset:0,dropTargetIndex:null,isOnionModeEnabled:!1,onionSkinBefore:5,onionSkinAfter:5,isFullOnionSkinEnabled:!1,motionTrailResolution:1,onionTrailCanvas:null,isAnimating:!1,isPaused:!1,animationMode:"loop",animationRequestId:null,animationStartTime:null,timeElapsedBeforePause:0,animationTotalDuration:5e3,animationProgress:0,timeDisplayMode:"seconds",isIKModeEnabled:!1,draggedEndEffector:null}}function ne(n,e,i,r,o,l,d,a){n.save(),n.strokeStyle="rgba(255, 255, 255, 0.4)",n.lineWidth=1,n.setLineDash([4,4]),n.beginPath(),n.moveTo(0,e),n.lineTo(r,e),n.stroke(),n.beginPath(),n.moveTo(i,0),n.lineTo(i,o),n.stroke(),n.setLineDash([]),n.lineCap="butt",n.lineWidth=d?8:5,n.strokeStyle=d?"rgba(255, 255, 0, 1)":"rgba(255, 255, 255, 0.6)",n.beginPath(),n.moveTo(0,e),n.lineTo(l,e),n.stroke(),n.lineWidth=a?8:5,n.strokeStyle=a?"rgba(255, 255, 0, 1)":"rgba(255, 255, 255, 0.6)",n.beginPath(),n.moveTo(i,o-l),n.lineTo(i,o),n.stroke(),n.restore()}function G(n,e,i={}){n.strokeStyle=i.strokeStyle||"#FFFFFF",n.lineWidth=3,n.lineCap="round",n.beginPath(),n.arc(e.head.x,e.head.y,20,0,Math.PI*2),n.stroke(),n.beginPath(),n.moveTo(e.neck.x,e.neck.y),n.lineTo(e.neckBase.x,e.neckBase.y),n.lineTo(e.hip.x,e.hip.y),n.stroke(),n.beginPath(),n.moveTo(e.neckBase.x,e.neckBase.y),n.lineTo(e.leftElbow.x,e.leftElbow.y),n.lineTo(e.leftHand.x,e.leftHand.y),n.moveTo(e.neckBase.x,e.neckBase.y),n.lineTo(e.rightElbow.x,e.rightElbow.y),n.lineTo(e.rightHand.x,e.rightHand.y),n.stroke(),n.fillStyle=i.fillStyle||"#FFFFFF";const r=8;n.beginPath(),n.arc(e.leftHand.x,e.leftHand.y,r,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.rightHand.x,e.rightHand.y,r,0,Math.PI*2),n.fill(),n.beginPath(),n.moveTo(e.hip.x,e.hip.y),n.lineTo(e.leftKnee.x,e.leftKnee.y),n.lineTo(e.leftFoot.x,e.leftFoot.y),n.moveTo(e.hip.x,e.hip.y),n.lineTo(e.rightKnee.x,e.rightKnee.y),n.lineTo(e.rightFoot.x,e.rightFoot.y),n.moveTo(e.leftFoot.x,e.leftFoot.y),n.lineTo(e.leftToe.x,e.leftToe.y),n.moveTo(e.rightFoot.x,e.rightFoot.y),n.lineTo(e.rightToe.x,e.rightToe.y),n.stroke()}function ie(n,e,i,r,o=!1){if(!r)return!1;n.fillStyle="rgba(255, 255, 0, 0.3)",n.strokeStyle="rgba(255, 255, 0, 0.5)",n.lineWidth=2;let l=!1;for(const d in e){const a=e[d];if(Math.hypot(r.x-a.x,r.y-a.y)<i){if(o){if(!["leftHand","rightHand","leftFoot","rightFoot","leftToe","rightToe"].includes(d))continue;n.fillStyle="rgba(0, 255, 255, 0.4)",n.strokeStyle="rgba(0, 255, 255, 0.8)"}else n.fillStyle="rgba(255, 255, 0, 0.3)",n.strokeStyle="rgba(255, 255, 0, 0.5)";n.beginPath(),n.arc(a.x,a.y,i,0,Math.PI*2),n.fill(),n.stroke(),l=!0}}return l}function F(n,e,i,r){const o={hip:{...n.hip}},l=["hip"];for(;l.length>0;){const d=l.shift(),a=o[d],h=r[d]||[];for(const f of h){const s=n.angles[f],t=i[`${f}-${d}`];s!==void 0&&t!==void 0&&(o[f]={x:a.x+Math.cos(s)*t,y:a.y+Math.sin(s)*t},l.push(f))}}return o}function oe(n,e){const i={hip:{...n.hip},angles:{}};for(const r in e){const o=e[r],l=n[r],d=n[o],a=l.x-d.x,h=l.y-d.y;i.angles[r]=Math.atan2(h,a)}return i}function re(n,e){const i=n/2,r=e/2,o={head:{x:i,y:r-80},neck:{x:i,y:r-60},neckBase:{x:i,y:r-40},hip:{x:i,y:r+20},leftElbow:{x:i-30,y:r-20},leftHand:{x:i-60,y:r+10},rightElbow:{x:i+30,y:r-20},rightHand:{x:i+60,y:r+10},leftKnee:{x:i-20,y:r+65},leftFoot:{x:i-30,y:r+110},leftToe:{x:i-50,y:r+110},rightKnee:{x:i+20,y:r+65},rightFoot:{x:i+30,y:r+110},rightToe:{x:i+50,y:r+110}},l={neckBase:"hip",neck:"neckBase",head:"neck",leftElbow:"neckBase",rightElbow:"neckBase",leftHand:"leftElbow",rightHand:"rightElbow",leftKnee:"hip",rightKnee:"hip",leftFoot:"leftKnee",rightFoot:"rightKnee",leftToe:"leftFoot",rightToe:"rightFoot"},d={};for(const f in l){const s=l[f];d[s]||(d[s]=[]),d[s].push(f)}const a={};for(const f in l){const s=f,t=l[s];a[`${s}-${t}`]=Math.hypot(o[s].x-o[t].x,o[s].y-o[t].y)}const h=oe(o,l);return{hierarchy:l,children:d,boneLengths:a,defaultPose:h}}function W(n){return{x:n.x+n.width-18-3,y:n.y+3,width:18,height:18}}function X(n,e){const r=e.x+n.time*e.width,o=e.y+e.height/2;return{x:r-16/2,y:o-16/2,width:16,height:16}}function le(n,e,i,r,o,l,d,a=!1){const h=l||a;n.fillStyle=h?"#444":r?"#888":"#666",n.fillRect(e.x,e.y,e.width,e.height);const f=d||a;n.fillStyle=f?"#444":o?"#888":"#666",n.fillRect(i.x,i.y,i.width,i.height),n.lineWidth=3,n.lineCap="round",n.lineJoin="round";const s=e.width*.2,t=e.height*.25;n.strokeStyle=h?"#666":"#FFF",n.beginPath(),n.moveTo(e.x+e.width/2+s,e.y+e.height/2-t),n.lineTo(e.x+e.width/2-s,e.y+e.height/2),n.lineTo(e.x+e.width/2+s,e.y+e.height/2+t),n.stroke(),n.strokeStyle=f?"#666":"#FFF",n.beginPath(),n.moveTo(i.x+i.width/2-s,i.y+i.height/2-t),n.lineTo(i.x+i.width/2+s,i.y+i.height/2),n.lineTo(i.x+i.width/2-s,i.y+i.height/2+t),n.stroke()}function ae(n,e,i,r,o,l,d,a,h,f,s,t,g,T,I,S,p){if(T!==null&&g!==null){const y=T-d;if(y>=0&&y<=e.length){let b;if(y<e.length)b=e[y].x-I/2;else{const E=e[e.length-1];b=E.x+E.width+I/2}i.length>0&&e.length>0&&(n.save(),n.fillStyle="#f0ad4e",n.fillRect(b-1.5,e[0].y,3,e[0].height),n.restore())}}e.forEach((y,b)=>{const E=d+b;if(!(E>=i.length)){if(n.save(),E===g&&(n.globalAlpha=.4),n.fillStyle="#000",n.fillRect(y.x,y.y,y.width,y.height),n.strokeStyle="#555",E===o?(n.strokeStyle="#f0ad4e",n.shadowColor="#f0ad4e",n.shadowBlur=10):E===l&&!f&&(n.strokeStyle="#777"),n.lineWidth=2,n.strokeRect(y.x,y.y,y.width,y.height),n.shadowBlur=0,i[E]){const N=E===o&&o!==null?r:i[E].pose,_=F(N,s.hierarchy,s.boneLengths,s.children),w=n;w.save(),w.translate(y.x,y.y),w.scale(y.width/a,y.height/h),G(w,_),w.restore(),n.fillStyle="rgba(255, 255, 255, 0.9)",n.font="bold 12px sans-serif",n.textAlign="left",n.textBaseline="top",n.fillText(String(E+1),y.x+4,y.y+4);const R=i[E];let x="";p==="seconds"?x=`${(R.time*S/1e3).toFixed(1)}s`:x=`${Math.round(R.time*(S/1e3)*60)}f`,n.fillStyle="rgba(255, 255, 255, 0.8)",n.font="11px sans-serif",n.textAlign="right",n.textBaseline="bottom",n.fillText(x,y.x+y.width-4,y.y+y.height-4);const k=W(y),C=E===t&&!f;n.save(),n.fillStyle=C?"#e63946":"rgba(200, 50, 50, 0.8)",n.strokeStyle="#FFFFFF",n.lineWidth=1.5,n.beginPath(),n.roundRect(k.x,k.y,k.width,k.height,[4]),n.fill();const P=5;n.beginPath(),n.moveTo(k.x+P,k.y+P),n.lineTo(k.x+k.width-P,k.y+k.height-P),n.moveTo(k.x+k.width-P,k.y+P),n.lineTo(k.x+P,k.y+k.height-P),n.stroke(),n.restore()}n.restore()}})}function de(n,e,i){const{keyframes:r,activeKeyframeIndex:o,hoveredMarkerIndex:l,isAnimating:d,animationProgress:a,isPaused:h,hoveredPlayhead:f}=i;if(n.fillStyle="#111",n.fillRect(e.x,e.y,e.width,e.height),n.strokeStyle="#555",n.lineWidth=1,n.strokeRect(e.x,e.y,e.width,e.height),r.forEach((s,t)=>{const g=X(s,e),T=t===l&&!d,I=t===o,S=t>0&&t<r.length-1;n.save(),n.translate(g.x+g.width/2,g.y+g.height/2),n.rotate(Math.PI/4);let p="#888";S||(p="#555"),I&&(p="#f0ad4e"),T&&S&&(p="#ec9b2e"),n.fillStyle=p,n.strokeStyle="#FFF",n.lineWidth=I||T?2:1,n.beginPath(),n.rect(-g.width/2,-g.height/2,g.width,g.height),n.fill(),n.stroke(),n.restore()}),r.length>0){const s=e.x+a*e.width,t=!d||h,g=t&&f;n.save(),n.strokeStyle=g?"#64faff":"#3498db",n.lineWidth=g?4:2,n.beginPath(),n.moveTo(s,e.y-4),n.lineTo(s,e.y+e.height+4),n.stroke(),t&&(n.fillStyle=g?"#64faff":"#3498db",n.beginPath(),n.arc(s,e.y+e.height/2,g?8:6,0,Math.PI*2),n.fill()),n.restore()}}function se(n,e){const r=e-180,o=396,a=r+5+65+5,h={x:50,y:a,width:n-100,height:12},f=100,s=75,t=a+h.height+5,g=10,T=5,I=40,S=T*f+(T-1)*g,p=(n-S)/2,y=Array.from({length:T},(_,w)=>({x:p+w*(f+g),y:t,width:f,height:s})),b=40,E={x:p-b-g,y:t,width:b,height:s},N={x:p+S+g,y:t,width:b,height:s};return{UI_PANEL_HEIGHT:180,POSING_AREA_HEIGHT:r,GROUND_Y_POSITION:o,TIMELINE_RECT:h,THUMBNAIL_RECTS:y,VISIBLE_THUMBNAILS:T,SCROLL_LEFT_BUTTON_RECT:E,SCROLL_RIGHT_BUTTON_RECT:N,GUIDE_GRABBER_SIZE:I,THUMBNAIL_GAP:g}}function fe(n,e,i,r,o,l){const d=r.POSING_AREA_HEIGHT;n.fillStyle="#222",n.fillRect(0,d,e,r.UI_PANEL_HEIGHT),n.strokeStyle="#444",n.lineWidth=1,n.strokeRect(0,d,e,r.UI_PANEL_HEIGHT),o.keyframes.length>0&&de(n,r.TIMELINE_RECT,o),ae(n,r.THUMBNAIL_RECTS,o.keyframes,o.stickFigurePose,o.activeKeyframeIndex,o.hoveredThumbnailIndex,o.scrollOffset,e,r.POSING_AREA_HEIGHT,o.isAnimating,l,o.hoveredDeleteIconIndex,o.draggedThumbnailIndex,o.dropTargetIndex,r.THUMBNAIL_GAP,o.animationTotalDuration,o.timeDisplayMode);const a=o.scrollOffset===0,h=o.scrollOffset>=o.keyframes.length-r.VISIBLE_THUMBNAILS;le(n,r.SCROLL_LEFT_BUTTON_RECT,r.SCROLL_RIGHT_BUTTON_RECT,o.hoveredScrollLeft,o.hoveredScrollRight,a,h,o.isAnimating)}function te(n,e,i,r,o,l){if(n.clearRect(0,0,e.width,e.height),i.activeKeyframeIndex!==null&&(n.save(),n.fillStyle="rgba(255, 255, 255, 0.7)",n.font="16px sans-serif",n.textAlign="left",n.textBaseline="top",n.fillText(`Keyframe: ${i.activeKeyframeIndex+1} / ${i.keyframes.length}`,15,15),n.restore()),ne(n,i.groundY,i.verticalGuideX,e.width,r.POSING_AREA_HEIGHT,r.GUIDE_GRABBER_SIZE,i.hoveredGround,i.hoveredVerticalGuide),i.isAnimating&&i.onionTrailCanvas&&n.drawImage(i.onionTrailCanvas,0,0),i.isOnionModeEnabled&&i.activeKeyframeIndex!==null){const f=i.activeKeyframeIndex,s=.4,t=(I,S,p)=>{var y;if(I>=0&&I<i.keyframes.length){const b=(y=i.keyframes[I])==null?void 0:y.pose;if(b&&b.hip&&b.angles){const E=s/S;if(E>.05){const N=F(b,o.hierarchy,o.boneLengths,o.children),_=`rgba(${p}, ${E})`;G(n,N,{strokeStyle:_,fillStyle:_})}}}},g="255, 87, 34",T="33, 150, 243";for(let I=1;I<=i.onionSkinBefore;I++)t(f-I,I,g);for(let I=1;I<=i.onionSkinAfter;I++)t(f+I,I,T)}const d=F(i.stickFigurePose,o.hierarchy,o.boneLengths,o.children);G(n,d);const h=!i.isAnimating&&!i.draggedMarkerIndex&&ie(n,d,15,i.currentMousePos,i.isIKModeEnabled);fe(n,e.width,e.height,r,i,o),i.draggedThumbnailIndex!==null?e.style.cursor="grabbing":i.isAnimating&&!i.isPaused?e.style.cursor="default":i.isDraggingPlayhead?e.style.cursor="grabbing":i.isDraggingGround?e.style.cursor="ns-resize":i.isDraggingVerticalGuide?e.style.cursor="ew-resize":i.draggedMarkerIndex!==null?e.style.cursor="grabbing":i.hoveredThumbnailIndex!==null&&i.hoveredDeleteIconIndex===null?e.style.cursor="grab":i.hoveredPlayhead?e.style.cursor="ew-resize":i.hoveredGround?e.style.cursor="ns-resize":i.hoveredVerticalGuide?e.style.cursor="ew-resize":i.hoveredMarkerIndex!==null?e.style.cursor="grab":h||i.hoveredDeleteIconIndex!==null||i.hoveredScrollLeft||i.hoveredScrollRight?e.style.cursor="pointer":e.style.cursor="default"}function z(n,e,i){return n*(1-i)+e*i}function he(n,e,i){const r=e-n;return Math.abs(r)>Math.PI&&(r>0?n+=2*Math.PI:e+=2*Math.PI),z(n,e,i)}function me(n,e,i){const r={};for(const l in n.angles)e.angles[l]!==void 0?r[l]=he(n.angles[l],e.angles[l],i):r[l]=n.angles[l];return{hip:{x:z(n.hip.x,e.hip.x,i),y:z(n.hip.y,e.hip.y,i)},angles:r}}function Y(n,e){if(e.length===0)return null;if(e.length===1)return JSON.parse(JSON.stringify(e[0].pose));let i=-1;for(let r=0;r<e.length-1;r++)if(n>=e[r].time&&n<=e[r+1].time){i=r;break}if(i===-1)return n>=1?JSON.parse(JSON.stringify(e[e.length-1].pose)):JSON.parse(JSON.stringify(e[0].pose));{const r=i+1,o=e[i],l=e[r],d=l.time-o.time,a=n-o.time,h=d===0?1:Math.min(1,a/d);return me(o.pose,l.pose,h)}}function Z(n){if(n.keyframes.length===0)return;const e=Y(n.animationProgress,n.keyframes);e&&(n.stickFigurePose=e)}function ge(n,e,i,r){if(!n.isFullOnionSkinEnabled||n.keyframes.length<2){n.onionTrailCanvas=null;return}const o=document.createElement("canvas");o.width=i.width,o.height=r.POSING_AREA_HEIGHT;const l=o.getContext("2d");if(!l){n.onionTrailCanvas=null;return}l.clearRect(0,0,o.width,o.height);const d=Math.floor(n.animationTotalDuration/1e3*60);if(d<2){n.onionTrailCanvas=null;return}const a=n.motionTrailResolution,h=Math.floor(d/a);if(h<=0){n.onionTrailCanvas=null;return}const s=`rgba(200, 225, 255, ${Math.max(.01,Math.min(.25,15/h))})`;for(let t=0;t<d;t+=a){const g=t/(d-1),T=Y(g,n.keyframes);if(T){const I=F(T,e.hierarchy,e.boneLengths,e.children);G(l,I,{strokeStyle:s,fillStyle:s})}}n.onionTrailCanvas=o}function U(n,e,i){if(!e.isAnimating||e.animationStartTime===null||e.keyframes.length<2)return;const r=e.animationMode==="ping-pong"?e.animationTotalDuration*2:e.animationTotalDuration,o=(n-e.animationStartTime)%r;let l;e.animationMode==="ping-pong"&&o>e.animationTotalDuration?l=(e.animationTotalDuration-(o-e.animationTotalDuration))/e.animationTotalDuration:l=o/e.animationTotalDuration,e.animationProgress=l,Z(e),i(),e.isAnimating&&(e.animationRequestId=requestAnimationFrame(d=>U(d,e,i)))}function ce(n,e,i,r,o,l){n.keyframes.length<2||(ge(n,r,l,o),n.isAnimating=!0,n.isPaused=!1,n.timeElapsedBeforePause=0,n.animationStartTime=performance.now(),n.activeKeyframeIndexBeforeAnimation=n.activeKeyframeIndex,n.activeKeyframeIndex=null,e(),n.animationRequestId=requestAnimationFrame(d=>U(d,n,i)))}function ue(n,e){n.animationRequestId&&cancelAnimationFrame(n.animationRequestId),n.animationRequestId=null,n.isAnimating=!1,n.isPaused=!1,n.onionTrailCanvas=null,n.activeKeyframeIndex=n.activeKeyframeIndexBeforeAnimation,n.activeKeyframeIndex!==null&&n.keyframes[n.activeKeyframeIndex]?(n.stickFigurePose=JSON.parse(JSON.stringify(n.keyframes[n.activeKeyframeIndex].pose)),n.animationProgress=n.keyframes[n.activeKeyframeIndex].time):n.keyframes.length>0?(n.activeKeyframeIndex=0,n.stickFigurePose=JSON.parse(JSON.stringify(n.keyframes[0].pose)),n.animationProgress=n.keyframes[0].time):n.animationProgress=0,e()}function ye(n,e){!n.isAnimating||n.isPaused||(n.animationRequestId&&cancelAnimationFrame(n.animationRequestId),n.animationRequestId=null,n.isPaused=!0,n.animationStartTime&&(n.timeElapsedBeforePause=performance.now()-n.animationStartTime),e())}function Ie(n,e,i){!n.isAnimating||!n.isPaused||(n.isPaused=!1,n.animationStartTime&&(n.animationStartTime=performance.now()-n.timeElapsedBeforePause),e(),n.animationRequestId=requestAnimationFrame(r=>U(r,n,i)))}function Te(n){const e=n.length;if(!(e<1)){if(e===1){n[0].time=0;return}n.forEach((i,r)=>{i.time=r/(e-1)})}}function H(n){n.activeKeyframeIndex!==null&&n.keyframes[n.activeKeyframeIndex]&&(n.keyframes[n.activeKeyframeIndex].pose=JSON.parse(JSON.stringify(n.stickFigurePose)))}function ve(n,e){H(n);const i={pose:JSON.parse(JSON.stringify(n.stickFigurePose)),time:0},r=n.activeKeyframeIndex===null?n.keyframes.length:n.activeKeyframeIndex+1;let o;if(n.keyframes.length===0)o=0;else{const d=r<n.keyframes.length?n.keyframes[r]:null;if(d){const a=n.keyframes[r-1];o=a.time+(d.time-a.time)/2}else{const a=n.keyframes[n.keyframes.length-1],h=n.animationTotalDuration,t=a.time*h+1e3;if(n.animationTotalDuration=t,t>0)for(const g of n.keyframes)g.time=g.time*h/t;o=1}}i.time=o,n.keyframes.splice(r,0,i),n.activeKeyframeIndex=r,n.animationProgress=o;const l=n.activeKeyframeIndex;l!==null&&(l<n.scrollOffset?n.scrollOffset=l:l>=n.scrollOffset+e.VISIBLE_THUMBNAILS&&(n.scrollOffset=l-e.VISIBLE_THUMBNAILS+1))}function Ee(n,e,i,r){H(n);const o=e===n.keyframes.length-1,l=n.animationTotalDuration;if(n.activeKeyframeIndex===e&&(n.activeKeyframeIndex=null,n.stickFigurePose=JSON.parse(JSON.stringify(i)),n.animationProgress=0,n.isOnionModeEnabled=!1),n.keyframes.splice(e,1),n.activeKeyframeIndex!==null&&n.activeKeyframeIndex>e&&n.activeKeyframeIndex--,n.keyframes.length===0)n.animationTotalDuration=5e3;else if(n.keyframes.length===1)n.keyframes[0].time=0;else if(o){const a=n.keyframes[n.keyframes.length-1].time*l;if(a>0&&l>0){n.animationTotalDuration=a;for(const h of n.keyframes)h.time=h.time*l/a}else n.keyframes.forEach(h=>h.time=0)}n.hoveredDeleteIconIndex=null,n.scrollOffset=Math.max(0,Math.min(n.scrollOffset,n.keyframes.length-r.VISIBLE_THUMBNAILS))}function pe(n,e,i){const r={pose:JSON.parse(JSON.stringify(e)),time:i};return n.keyframes.push(r),n.keyframes.sort((o,l)=>o.time-l.time),n.keyframes.indexOf(r)}function $(n,e){const i=n.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}function A(n,e){return n.x>e.x&&n.x<e.x+e.width&&n.y>e.y&&n.y<e.y+e.height}function ke(n){if(n.length===0){console.warn("No keyframes to export.");return}const e={version:"1.1.1",format:"stick-figure-animation",exportedAt:new Date().toISOString(),keyframes:n,metadata:{totalKeyframes:n.length,duration:n.length>1?n[n.length-1].time-n[0].time:0,hasIKSupport:!0}},i=JSON.stringify(e,null,2),r=new Blob([i],{type:"application/json"}),o=URL.createObjectURL(r),l=document.createElement("a");l.href=o,l.download="stick-figure-animation.json",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(o)}function J(n){n.angles.neck!==void 0&&n.angles.neckBase===void 0&&(n.angles.neckBase=n.angles.neck,n.angles.neck=-Math.PI/2);const e={neckBase:Math.PI/2,neck:Math.PI/2,head:Math.PI/2,leftElbow:-Math.PI/4,rightElbow:Math.PI/4,leftHand:-Math.PI/6,rightHand:Math.PI/6,leftKnee:Math.PI/6,rightKnee:Math.PI/6,leftFoot:0,rightFoot:0,leftToe:Math.PI,rightToe:0};for(const[i,r]of Object.entries(e))n.angles[i]===void 0&&(n.angles[i]=r);return n}function Se(n){return new Promise((e,i)=>{const r=new FileReader;r.onload=o=>{var l;try{const d=(l=o.target)==null?void 0:l.result;if(typeof d!="string")throw new Error("Failed to read file.");const a=JSON.parse(d);let h=[];if(a.version&&a.format==="stick-figure-animation"&&a.keyframes){console.log(`Loading animation file version ${a.version}`);const f=a.version;if((f==="1.0.0"||f==="0.0.0"||f==="1.1.0")&&console.log("Converting from older version to v1.1.1 format (adding neckBase joint)"),Array.isArray(a.keyframes))h=a.keyframes.map(s=>({...s,pose:J(s.pose)}));else throw new Error("Invalid versioned keyframe file: keyframes array missing.")}else if(Array.isArray(a)){if(a.length===0){e([]);return}if(a[0].pose!==void 0&&typeof a[0].time=="number")console.log("Loading legacy new format (array of Keyframes)"),h=a.map(f=>({...f,pose:J(f.pose)}));else if(a[0].hip!==void 0&&a[0].angles!==void 0){console.log("Loading legacy old format (array of StickFigurePose)");const f=a.length;h=a.map((s,t)=>({pose:J(s),time:f<=1?0:t/(f-1)}))}else throw new Error("Unrecognized keyframe file format.")}else throw new Error("Invalid keyframe file: not a valid format.");if(h.some(f=>{var s,t,g;return typeof((t=(s=f.pose)==null?void 0:s.hip)==null?void 0:t.x)!="number"||typeof((g=f.pose)==null?void 0:g.angles)!="object"}))throw new Error("Invalid keyframe file format.");e(h)}catch(d){console.error("Error loading keyframes:",d),i(d)}},r.onerror=()=>{i(new Error("Error reading file."))},r.readAsText(n)})}function be(n,e,i,r){const o=n.x-e.x,l=n.y-e.y,d=Math.hypot(o,l),a=Math.max(1e-6,Math.min(d,i+r-1e-6)),h=Math.acos((i*i+a*a-r*r)/(2*i*a)),f=Math.acos((i*i+r*r-a*a)/(2*i*r)),t=Math.atan2(l,o)-h,g=t+(Math.PI-f);return[t,g]}function Pe(n,e,i,r){const o=JSON.parse(JSON.stringify(i)),l=F(i,r.hierarchy,r.boneLengths,r.children),a={leftHand:{base:"neckBase",joints:["leftElbow","leftHand"]},rightHand:{base:"neckBase",joints:["rightElbow","rightHand"]},leftFoot:{base:"hip",joints:["leftKnee","leftFoot"]},rightFoot:{base:"hip",joints:["rightKnee","rightFoot"]},leftToe:{base:"leftFoot",joints:["leftToe"]},rightToe:{base:"rightFoot",joints:["rightToe"]}}[e];if(!a)return null;const h=l[a.base];if(!h)return null;if(a.joints.length===1){const f=a.joints[0];if(r.boneLengths[`${f}-${a.base}`]!==void 0){const t=n.x-h.x,g=n.y-h.y;o.angles[f]=Math.atan2(g,t)}}else if(a.joints.length===2){const[f,s]=a.joints,t=r.boneLengths[`${f}-${a.base}`],g=r.boneLengths[`${s}-${f}`];if(t!==void 0&&g!==void 0){const T=be(n,h,t,g);T&&(o.angles[f]=T[0],o.angles[s]=T[1])}}return o}function q(n){return["leftHand","rightHand","leftFoot","rightFoot","leftToe","rightToe"].includes(n)}function Me(n,e,i,r,o,l){const{canvas:d,animateBtn:a,pauseBtn:h,modeBtn:f,ikModeBtn:s,onionBtn:t,exportBtn:g,importBtn:T,importInput:I,durationInput:S,onionBeforeInput:p,onionAfterInput:y,insertKeyframeBtn:b,timeModeToggleBtn:E,fullOnionSkinBtn:N,motionTrailStepInput:_}=n,{defaultPose:w,hierarchy:R,boneLengths:x,children:k}=r,C=15,P=10;a.addEventListener("click",()=>{e.isAnimating?ue(e,o):e.keyframes.length>=2&&(H(e),ce(e,o,l,r,i,d))}),h.addEventListener("click",()=>{e.isAnimating&&(e.isPaused?Ie(e,o,l):ye(e,o))}),b.addEventListener("click",()=>{if(b.disabled)return;const c=pe(e,e.stickFigurePose,e.animationProgress);e.animationRequestId&&cancelAnimationFrame(e.animationRequestId),e.animationRequestId=null,e.isAnimating=!1,e.isPaused=!1,e.activeKeyframeIndex=c,e.activeKeyframeIndex<e.scrollOffset?e.scrollOffset=e.activeKeyframeIndex:e.activeKeyframeIndex>=e.scrollOffset+i.VISIBLE_THUMBNAILS&&(e.scrollOffset=e.activeKeyframeIndex-i.VISIBLE_THUMBNAILS+1),o()}),f.addEventListener("click",()=>{e.keyframes.length<2||(e.animationMode=e.animationMode==="loop"?"ping-pong":"loop",o())}),s.addEventListener("click",()=>{e.isAnimating||(e.isIKModeEnabled=!e.isIKModeEnabled,e.draggedEndEffector=null,o())}),t.addEventListener("click",()=>{e.isAnimating||e.activeKeyframeIndex===null||(e.isOnionModeEnabled=!e.isOnionModeEnabled,o())}),N.addEventListener("click",()=>{N.disabled||(e.isFullOnionSkinEnabled=!e.isFullOnionSkinEnabled,o())}),_.addEventListener("change",()=>{const c=parseInt(_.value,10);!isNaN(c)&&c>=1?e.motionTrailResolution=c:_.value=e.motionTrailResolution.toString()}),p.addEventListener("change",()=>{const c=parseInt(p.value,10);!isNaN(c)&&c>=0?(e.onionSkinBefore=c,e.isOnionModeEnabled&&o()):p.value=e.onionSkinBefore.toString()}),y.addEventListener("change",()=>{const c=parseInt(y.value,10);!isNaN(c)&&c>=0?(e.onionSkinAfter=c,e.isOnionModeEnabled&&o()):y.value=e.onionSkinAfter.toString()}),g.addEventListener("click",()=>{e.isAnimating||e.keyframes.length===0||(H(e),ke(e.keyframes))}),T.addEventListener("click",()=>{e.isAnimating||I.click()}),I.addEventListener("change",async c=>{var u;const m=(u=c.target.files)==null?void 0:u[0];if(m)try{H(e);const v=await Se(m);e.keyframes=v,e.scrollOffset=0,e.keyframes.length>0?(e.activeKeyframeIndex=0,e.stickFigurePose=JSON.parse(JSON.stringify(e.keyframes[0].pose)),e.animationProgress=e.keyframes[0].time):(e.activeKeyframeIndex=null,e.stickFigurePose=JSON.parse(JSON.stringify(w)),e.animationProgress=0),e.isOnionModeEnabled=!1,o()}catch{alert("Failed to load keyframes. Please check the file format.")}c.target.value=""}),E.addEventListener("click",()=>{e.isAnimating||(e.timeDisplayMode=e.timeDisplayMode==="seconds"?"frames":"seconds",o())}),S.addEventListener("change",()=>{if(e.timeDisplayMode==="seconds"){const c=parseFloat(S.value);!isNaN(c)&&c>0?e.animationTotalDuration=c*1e3:alert("Invalid duration. Please enter a positive number.")}else{const c=parseInt(S.value,10);!isNaN(c)&&c>0?e.animationTotalDuration=c/60*1e3:alert("Invalid duration. Please enter a positive integer for frames.")}o()}),d.addEventListener("mousedown",c=>{const m=$(d,c);if(e.isAnimating&&!e.isPaused)return;if(e.hoveredPlayhead){e.isDraggingPlayhead=!0,e.activeKeyframeIndex=null,o();return}if(e.hoveredMarkerIndex!==null){e.activeKeyframeIndex!==e.hoveredMarkerIndex&&(H(e),e.activeKeyframeIndex=e.hoveredMarkerIndex,e.stickFigurePose=JSON.parse(JSON.stringify(e.keyframes[e.hoveredMarkerIndex].pose)),e.animationProgress=e.keyframes[e.hoveredMarkerIndex].time,e.activeKeyframeIndex<e.scrollOffset?e.scrollOffset=e.activeKeyframeIndex:e.activeKeyframeIndex>=e.scrollOffset+i.VISIBLE_THUMBNAILS&&(e.scrollOffset=e.activeKeyframeIndex-i.VISIBLE_THUMBNAILS+1)),e.hoveredMarkerIndex>0&&e.hoveredMarkerIndex<e.keyframes.length-1&&(e.draggedMarkerIndex=e.hoveredMarkerIndex),o();return}const u={x:0,y:e.groundY-P,width:i.GUIDE_GRABBER_SIZE,height:P*2};if(A(m,u)&&m.y<i.POSING_AREA_HEIGHT){e.isDraggingGround=!0;return}const v={x:e.verticalGuideX-P,y:i.POSING_AREA_HEIGHT-i.GUIDE_GRABBER_SIZE,width:P*2,height:i.GUIDE_GRABBER_SIZE};if(A(m,v)&&m.y<i.POSING_AREA_HEIGHT){e.isDraggingVerticalGuide=!0;return}if(e.hoveredDeleteIconIndex!==null){Ee(e,e.hoveredDeleteIconIndex,w,i),o();return}if(A(m,i.SCROLL_LEFT_BUTTON_RECT)){e.scrollOffset=Math.max(0,e.scrollOffset-1),o();return}if(A(m,i.SCROLL_RIGHT_BUTTON_RECT)){e.scrollOffset=Math.min(e.scrollOffset+1,Math.max(0,e.keyframes.length-i.VISIBLE_THUMBNAILS)),o();return}for(let D=0;D<i.THUMBNAIL_RECTS.length;D++){const K=e.scrollOffset+D;if(A(m,i.THUMBNAIL_RECTS[D])&&e.keyframes[K]){e.activeKeyframeIndex!==K&&(H(e),e.activeKeyframeIndex=K,e.stickFigurePose=JSON.parse(JSON.stringify(e.keyframes[K].pose)),e.animationProgress=e.keyframes[K].time),e.draggedThumbnailIndex=K,o();return}}const M=F(e.stickFigurePose,R,x,k);let B=null,j=1/0;for(const D in M){const K=D,V=Math.hypot(m.x-M[K].x,m.y-M[K].y);V<C&&V<j&&(j=V,B=K)}e.isIKModeEnabled&&B&&!q(B)&&(B=null),e.draggedPointKey=B,e.draggedEndEffector=e.isIKModeEnabled&&B&&q(B)?B:null,!e.draggedPointKey&&m.y<i.POSING_AREA_HEIGHT&&(ve(e,i),o())}),d.addEventListener("mousemove",c=>{const m=$(d,c);if(e.currentMousePos=m,e.draggedThumbnailIndex!==null){e.dropTargetIndex=null;for(let u=0;u<i.THUMBNAIL_RECTS.length;u++){const v=i.THUMBNAIL_RECTS[u],M=e.scrollOffset+u;if(!(M>=e.keyframes.length)&&A(m,v)){if(M===e.draggedThumbnailIndex)e.dropTargetIndex=null;else{const B=v.x+v.width/2;e.dropTargetIndex=m.x<B?M:M+1}break}}o();return}if(e.isDraggingPlayhead){const u=i.TIMELINE_RECT;let v=(m.x-u.x)/u.width;v=Math.max(0,Math.min(1,v)),e.animationProgress=v,e.timeElapsedBeforePause=e.animationProgress*e.animationTotalDuration,Z(e),o();return}if(e.draggedMarkerIndex!==null){const u=i.TIMELINE_RECT;let v=(m.x-u.x)/u.width;const M=e.keyframes[e.draggedMarkerIndex-1].time,B=e.keyframes[e.draggedMarkerIndex+1].time;v=Math.max(M,Math.min(v,B)),e.keyframes[e.draggedMarkerIndex].time=v,o();return}if(e.isDraggingGround){e.groundY=Math.max(0,Math.min(m.y,i.POSING_AREA_HEIGHT)),o();return}if(e.isDraggingVerticalGuide){e.verticalGuideX=Math.max(0,Math.min(m.x,d.width)),o();return}if(e.hoveredScrollLeft=!1,e.hoveredScrollRight=!1,e.hoveredThumbnailIndex=null,e.hoveredDeleteIconIndex=null,e.hoveredMarkerIndex=null,e.hoveredGround=!1,e.hoveredVerticalGuide=!1,e.hoveredPlayhead=!1,!e.isAnimating||e.isPaused){if(e.keyframes.length>0){const v={x:i.TIMELINE_RECT.x+e.animationProgress*i.TIMELINE_RECT.width-6,y:i.TIMELINE_RECT.y-6,width:12,height:i.TIMELINE_RECT.height+12};A(m,v)&&(e.hoveredPlayhead=!0)}e.hoveredScrollLeft=A(m,i.SCROLL_LEFT_BUTTON_RECT),e.hoveredScrollRight=A(m,i.SCROLL_RIGHT_BUTTON_RECT);for(let u=0;u<e.keyframes.length;u++){const v=X(e.keyframes[u],i.TIMELINE_RECT);if(A(m,v)){e.hoveredMarkerIndex=u;break}}if(m.y<i.POSING_AREA_HEIGHT){const u={x:0,y:e.groundY-P,width:i.GUIDE_GRABBER_SIZE,height:P*2},v={x:e.verticalGuideX-P,y:i.POSING_AREA_HEIGHT-i.GUIDE_GRABBER_SIZE,width:P*2,height:i.GUIDE_GRABBER_SIZE};A(m,u)?e.hoveredGround=!0:A(m,v)&&(e.hoveredVerticalGuide=!0)}for(let u=0;u<i.THUMBNAIL_RECTS.length;u++){const v=i.THUMBNAIL_RECTS[u],M=e.scrollOffset+u;if(e.keyframes[M]&&A(m,v)){e.hoveredThumbnailIndex=M;const B=W(v);if(A(m,B)){e.hoveredDeleteIconIndex=M,e.hoveredThumbnailIndex=null;break}}}}if(e.draggedPointKey)if(m.y=Math.min(m.y,i.POSING_AREA_HEIGHT-2),e.isIKModeEnabled&&e.draggedEndEffector){const u=Pe(m,e.draggedEndEffector,e.stickFigurePose,r);u&&(e.stickFigurePose=u)}else if(e.draggedPointKey==="hip")e.stickFigurePose.hip=m;else{const u=R[e.draggedPointKey],M=F(e.stickFigurePose,R,x,k)[u],B=Math.atan2(m.y-M.y,m.x-M.x);e.stickFigurePose.angles[e.draggedPointKey]=B}o()}),d.addEventListener("mouseup",()=>{if(e.draggedThumbnailIndex!==null&&e.dropTargetIndex!==null){const c=e.draggedThumbnailIndex;let m=e.dropTargetIndex;const[u]=e.keyframes.splice(c,1);c<m&&m--,e.keyframes.splice(m,0,u),e.activeKeyframeIndex=m,Te(e.keyframes),e.keyframes[m]&&(e.animationProgress=e.keyframes[m].time)}e.draggedPointKey=null,e.draggedEndEffector=null,e.isDraggingGround=!1,e.isDraggingVerticalGuide=!1,e.draggedMarkerIndex=null,e.isDraggingPlayhead=!1,e.draggedThumbnailIndex=null,e.dropTargetIndex=null,o()}),d.addEventListener("mouseleave",()=>{e.draggedPointKey=null,e.draggedEndEffector=null,e.isDraggingGround=!1,e.isDraggingVerticalGuide=!1,e.draggedMarkerIndex=null,e.isDraggingPlayhead=!1,e.draggedThumbnailIndex=null,e.dropTargetIndex=null,e.currentMousePos=null,(!e.isAnimating||e.isPaused)&&(e.hoveredScrollLeft=!1,e.hoveredScrollRight=!1,e.hoveredThumbnailIndex=null,e.hoveredDeleteIconIndex=null,e.hoveredGround=!1,e.hoveredVerticalGuide=!1,e.hoveredMarkerIndex=null,e.hoveredPlayhead=!1),o()}),window.addEventListener("keydown",c=>{if(!(e.isAnimating||document.activeElement&&document.activeElement.tagName==="INPUT"||e.isDraggingGround||e.isDraggingVerticalGuide||e.draggedMarkerIndex!==null)&&(c.key==="ArrowLeft"||c.key==="ArrowRight")){if(c.preventDefault(),e.keyframes.length===0)return;let m;e.activeKeyframeIndex===null?m=c.key==="ArrowLeft"?e.keyframes.length-1:0:m=c.key==="ArrowLeft"?e.activeKeyframeIndex-1:e.activeKeyframeIndex+1,m>=0&&m<e.keyframes.length&&(H(e),e.activeKeyframeIndex=m,e.stickFigurePose=JSON.parse(JSON.stringify(e.keyframes[e.activeKeyframeIndex].pose)),e.animationProgress=e.keyframes[e.activeKeyframeIndex].time,e.activeKeyframeIndex<e.scrollOffset?e.scrollOffset=e.activeKeyframeIndex:e.activeKeyframeIndex>=e.scrollOffset+i.VISIBLE_THUMBNAILS&&(e.scrollOffset=e.activeKeyframeIndex-i.VISIBLE_THUMBNAILS+1),o())}})}const O=(n,e="0 0 24 24")=>`<svg xmlns="http://www.w3.org/2000/svg" viewBox="${e}" width="22" height="22" fill="currentColor">${n}</svg>`,L={play:O('<path d="M8 5v14l11-7z"/>'),pause:O('<path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>'),stop:O('<path d="M6 6h12v12H6z"/>'),insert:O('<path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>'),loop:O('<path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/>'),pingpong:O('<path d="M8 4l-4 4 4 4V9h8v3l4-4-4-4v3H8V4zm8 13v-3h-8V9l-4 4 4 4v-3h8v3z" />'),onion:O('<path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5C21.27 7.61 17 4.5 12 4.5zm0 12c-2.48 0-4.5-2.02-4.5-4.5S9.52 7.5 12 7.5s4.5 2.02 4.5 4.5-2.02 4.5-4.5 4.5zm0-7C10.62 9.5 9.5 10.62 9.5 12s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5S13.38 9.5 12 9.5z"/>'),export:O('<path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>'),import:O('<path d="M9 16h6v-6h4l-7-7-7 7h4v6zm-4 2h14v2H5v-2z"/>'),motionTrail:O('<path d="M4 6v12h2V6H4zm5 0v12h2V6H9zm5 0v12h2V6h-2z"/>'),ik:O('<path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>')};function Be(n,e){n.animateBtn.innerHTML=e.isAnimating?L.stop:L.play,n.animateBtn.title=e.isAnimating?"Stop Animation":"Animate",n.animateBtn.disabled=e.keyframes.length<2&&!e.isAnimating,n.pauseBtn.innerHTML=e.isPaused?L.play:L.pause,n.pauseBtn.title=e.isPaused?"Resume":"Pause",n.pauseBtn.disabled=!e.isAnimating,n.ikModeBtn.classList.toggle("active",e.isIKModeEnabled),n.ikModeBtn.title=e.isIKModeEnabled?"Disable IK Mode":"Enable IK Mode",n.ikModeBtn.disabled=e.isAnimating;const i=e.keyframes.some(h=>Math.abs(h.time-e.animationProgress)<1e-4),r=e.isAnimating&&e.isPaused,o=!e.isAnimating&&e.activeKeyframeIndex===null&&e.keyframes.length>=2,l=r||e.isDraggingPlayhead||o;n.insertKeyframeBtn.disabled=!l||i,n.modeBtn.innerHTML=e.animationMode==="loop"?L.loop:L.pingpong,n.modeBtn.title=`Mode: ${e.animationMode==="loop"?"Loop":"Ping-Pong"}`,n.modeBtn.disabled=e.keyframes.length<2;const d=e.isAnimating||e.activeKeyframeIndex===null;n.onionBtn.disabled=d,n.onionBtn.classList.toggle("active",e.isOnionModeEnabled&&!d),n.onionBeforeInput.disabled=d,n.onionAfterInput.disabled=d;const a=e.isAnimating;if(n.fullOnionSkinBtn.disabled=a,n.fullOnionSkinBtn.classList.toggle("active",e.isFullOnionSkinEnabled&&!a),n.motionTrailStepInput.disabled=a,n.motionTrailStepInput.value=e.motionTrailResolution.toString(),n.exportBtn.disabled=e.isAnimating||e.keyframes.length===0,n.importBtn.disabled=e.isAnimating,n.timeModeToggleBtn.disabled=e.isAnimating,n.timeModeToggleBtn.textContent=e.timeDisplayMode==="seconds"?"Use Frames":"Use Seconds",e.timeDisplayMode==="seconds")n.durationLabel.textContent="Duration (s):",n.durationInput.value=(e.animationTotalDuration/1e3).toFixed(1),n.durationInput.step="0.1",n.durationInput.min="0.1";else{const h=Math.round(e.animationTotalDuration/1e3*60);n.durationLabel.textContent="Duration (f):",n.durationInput.value=String(h),n.durationInput.step="1",n.durationInput.min="1"}n.durationInput.disabled=e.isAnimating}function Ae(){const n=Q(),{canvas:e,insertKeyframeBtn:i,onionBtn:r,exportBtn:o,importBtn:l,fullOnionSkinBtn:d,ikModeBtn:a}=n;e.width=800,e.height=720;const h=e.getContext("2d");if(!h)return;const f=se(e.width,e.height),s=re(e.width,f.POSING_AREA_HEIGHT),t=ee(s,f),g=()=>te(h,e,t,f,s),T=()=>{Be(n,t),g()};i.innerHTML=L.insert,r.innerHTML=L.onion,d.innerHTML=L.motionTrail,o.innerHTML=L.export,l.innerHTML=L.import,a.innerHTML=L.ik,Me(n,t,f,s,T,g),T()}Ae();
